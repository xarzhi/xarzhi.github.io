# ä¸‰ã€é¡¹ç›®æ¡†æ¶

## 1.React Cli

### 1.1 é¡¹ç›®ç›®å½•

```test
react-cli
â”œâ”€ .eslintrc.js
â”œâ”€ babel.config.js
â”œâ”€ config
â”‚  â”œâ”€ webpack.dev.js		// å¼€å‘ç¯å¢ƒ
â”‚  â””â”€ webpack.prod.js		// ç”Ÿäº§ç¯å¢ƒ
â”œâ”€ package.json				
â”œâ”€ public			// é™æ€èµ„æº
â”‚  â”œâ”€ favicon.ico
â”‚  â””â”€ index.html
â”œâ”€ src
â”‚  â”œâ”€ App.jsx
â”‚  â”œâ”€ main.js		// å…¥å£æ–‡ä»¶
â”‚  â”œâ”€ pages			// è·¯ç”±é¡µé¢
â”‚  â”‚  â”œâ”€ About
â”‚  â”‚  â”‚  â””â”€ index.jsx
â”‚  â”‚  â””â”€ Home
â”‚  â”‚     â”œâ”€ index.jsx
â”‚  â”‚     â””â”€ index.less
â”‚  â””â”€ router		// è·¯ç”±æ–‡ä»¶
â”‚     â””â”€ index.jsx
â”œâ”€ yarn-error.log
â””â”€ yarn.lock
```

### 1.2 ä¸‹è½½ä¾èµ–

```bash
yarn add @babel/core @pmmmwh/react-refresh-webpack-plugin babel-loader babel-preset-react-app copy-webpack-plugin cross-env css-loader css-minimizer-webpack-plugin eslint eslint-config-react-app eslint-webpack-plugin html-webpack-plugin image-minimizer-webpack-plugin less less-loader mini-css-extract-plugin postcss-loader postcss-preset-env react-refresh sass-loader style-loader stylus-loader terser-webpack-plugin webpack webpack-cli webpack-dev-server -D
```

```bash
yarn add react react-dom react-router-dom
```



### 1.3 å„æ–‡ä»¶å†…å®¹

#### 1.3.1 webpack.dev.js

> config/webpack.dev.js

```js
const path = require("path");
const EslintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const ReactRefreshWebpackPlugin = require("@pmmmwh/react-refresh-webpack-plugin");
const getStyleLoaders = (loader) => {
  return [
    "style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: ["postcss-preset-env"],
        },
      },
    },
    loader,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: undefined,
    filename: "static/js/[name].js",
    chunkFilename: "static/js/[name].js",
    assetModuleFilename: "static/media/[hash:10][ext][]query",
  },
  module: {
    rules: [
      // å¤„ç†css
      {
        test: /\.css$/,
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      // å¤„ç†å›¾ç‰‡
      {
        test: /\.(jpe?g|png|gif|webp|svg)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024,
          },
        },
      },
      // å¤„ç†å…¶ä»–èµ„æº
      {
        test: /\.(woff2?|ttf)/,
        type: "asset/resource",
      },
      {
        test: /\.jsx?$/,
        include: path.resolve(__dirname, "../src"),
        loader: "babel-loader",
        options: {
          cacheDirectory: true,
          cacheCompression: false,
          plugins: ["react-refresh/babel"],
        },
      },
    ],
  },
  plugins: [
    new ReactRefreshWebpackPlugin(),  // jsçƒ­æ›´æ–°
    new EslintWebpackPlugin({
      extensions: [".js", ".jsx"],
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({     
      template: path.resolve(__dirname, "../public/index.html"),
    }),
  ],
  mode: "development",
  devtool: "cheap-module-source-map",
  optimization: {
    splitChunks: {
      chunks: "all",
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
  },
  resolve: {
    extensions: [".jsx", ".js", ".json"],
  },
  devServer: {
    host: "localhost",
    port: 3000,
    open: true,
    hot: true,
    compress: true,
    historyApiFallback: true,
  },
};
```

#### 1.3.2 webpack.prod.js

> config/webpack.prod.js

```js
const path = require("path");
const EslintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMIniMizerWebpackPlugin = require("css-minimizer-webpack-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const ImageMinimizerWebpackPlugin = require("image-minimizer-webpack-plugin");
const CopyPlugin=require('copy-webpack-plugin');
const getStyleLoaders = (loader) => {
  return [
    MiniCssExtractPlugin.loader,
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: ["postcss-preset-env"],
        },
      },
    },
    loader,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../dist"),
    filename: "static/js/[name].[contenthash:10].js",
    chunkFilename: "static/js/[name].[contenthash:10].js",
    assetModuleFilename: "static/media/[hash:10][ext][query]",
  },
  module: {
    rules: [
      // å¤„ç†css
      {
        test: /\.css$/,
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      // å¤„ç†å›¾ç‰‡
      {
        test: /\.(jpe?g|png|gif|webp|svg)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024,
          },
        },
      },
      // å¤„ç†å…¶ä»–èµ„æº
      {
        test: /\.(woff2?|ttf)/,
        type: "asset/resource",
      },
      {
        test: /\.jsx?$/,
        include: path.resolve(__dirname, "../src"),
        loader: "babel-loader",
        options: {
          cacheDirectory: true,
          cacheCompression: false,
        },
      },
    ],
  },
  plugins: [
    new EslintWebpackPlugin({
      extensions: [".js", ".jsx"],
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    new MiniCssExtractPlugin({
      filename: "static/css/[name].[contenthash:10].css",
      chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
    }),
    new CopyPlugin({
      patterns: [
        {
          from: path.resolve(__dirname, "../public"),
          to: path.resolve(__dirname, "../dist"),
          toType: "dir",
          noErrorOnMissing: true, // ä¸ç”Ÿæˆé”™è¯¯
          globOptions: {
            // å¿½ç•¥æ–‡ä»¶
            ignore: ["**/index.html"],
          },
          info: {
            // è·³è¿‡terserå‹ç¼©js
            minimized: true,
          },
        },
      ],
    }),
  ],
  mode: "production",
  devtool: "source-map",
  optimization: {
    splitChunks: {
      chunks: "all",
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
    minimizer: [
      new CssMIniMizerWebpackPlugin(),
      new TerserWebpackPlugin(),
      new ImageMinimizerWebpackPlugin({
        minimizer: {
          implementation: ImageMinimizerWebpackPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
  },
  resolve: {
    extensions: [".jsx", ".js", ".json"],
  },
};
```

#### 1.3.3 router

> src/router/index.jsx

```jsx
import { lazy } from "react";

const Home = lazy(() =>
  import(/* webpackChunkName:'home' */ "../pages/Home/index")
);
const About = lazy(() => import("../pages/About/index"));

const routes = [
  {
    path: "/home",
    element: <Home />,
  },
  {
    path: "/about",
    element: <About />,
  },
];

export default routes;
```

#### 1.3.4 App.jsx

> src/App.jsx

```jsx
import { Suspense } from "react";
import { Link, useRoutes } from "react-router-dom";
import routes from "./router/index";

const App = () => {
  const element = useRoutes(routes);
  return (
    <>
      <fieldset>
        <legend>App</legend>
        <ul>
          <li>
            <Link to="/home">Home</Link>
          </li>
          <li>
            <Link to="/about">About</Link>
          </li>
        </ul>
        <Suspense fallback={<div>loading...</div>}>{element}</Suspense>
      </fieldset>
    </>
  );
};

export default App;
```

#### 1.3.5 main.js

> src/main.js

```jsx
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App";
import { BrowserRouter } from "react-router-dom";
const root = ReactDOM.createRoot(document.querySelector("#app"));
root.render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);
```

#### 1.3.6 package.json

> package.json

```js
{
  "name": "react-cli",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.dev.js",
    "build": "cross-env NODE_ENV=production webpack --config ./config/webpack.prod.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "browserslist": [
    "last 2 version",
    "> 1%",
    "not dead"
  ],
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.15.0"
  },
  "devDependencies": {
    "@babel/core": "^7.22.15",
    "@pmmmwh/react-refresh-webpack-plugin": "^0.5.11",
    "babel-loader": "^9.1.3",
    "babel-preset-react-app": "^10.0.1",
    "copy-webpack-plugin": "^11.0.0",
    "cross-env": "^7.0.3",
    "css-loader": "^6.8.1",
    "css-minimizer-webpack-plugin": "^5.0.1",
    "eslint": "^8.48.0",
    "eslint-config-react-app": "^7.0.1",
    "eslint-webpack-plugin": "^4.0.1",
    "html-webpack-plugin": "^5.5.3",
    "image-minimizer-webpack-plugin": "^3.8.3",
    "less": "^4.2.0",
    "less-loader": "^11.1.3",
    "mini-css-extract-plugin": "^2.7.6",
    "postcss-loader": "^7.3.3",
    "postcss-preset-env": "^9.1.3",
    "react-refresh": "^0.14.0",
    "sass-loader": "^13.3.2",
    "style-loader": "^3.3.3",
    "stylus-loader": "^7.1.3",
    "terser-webpack-plugin": "^5.3.9",
    "webpack": "^5.88.2",
    "webpack-cli": "^5.1.4",
    "webpack-dev-server": "^4.15.1"
  }
}
```

#### 1.3.7 babel.config.js

> babel.config.js

```js
module.exports = {
  presets: [
    "react-app",
    "@babel/preset-env",
    ["@babel/preset-react", { runtime: "automatic" }],
  ],
};
```

#### 1.3.8 .eslintrc.js

> .eslintrc.js

```js
module.exports = {
  extends: ["react-app"],
  parserOptions: {
    babelOptions: {
      presets: [
        ["babel-preset-react-app", false],
        "babel-preset-react-app/prod",
      ],
    },
  },
};
```

### 1.4 åˆå¹¶é…ç½®

å‰é¢ä¸¤ä¸ªé…ç½®æ–‡ä»¶æœ‰å¤ªå¤šç›¸åŒçš„ä»£ç 

é€šè¿‡ `process.env.NODE_ENV`åˆ¤æ–­å½“å‰å¤„äºä»€ä¹ˆçœ‹æ³•æ¨¡å¼ï¼Œä»è€Œåˆå¹¶ä¸¤ä¸ªé…ç½®æ–‡ä»¶

```js
const path = require("path");
const EslintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMIniMizerWebpackPlugin = require("css-minimizer-webpack-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const ImageMinimizerWebpackPlugin = require("image-minimizer-webpack-plugin");
const ReactRefreshWebpackPlugin = require("@pmmmwh/react-refresh-webpack-plugin");

const CopyPlugin = require("copy-webpack-plugin");

const isProduction = process.env.NODE_ENV === "production";

const getStyleLoaders = (loader) => {
  return [
    isProduction ? MiniCssExtractPlugin.loader : "style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: ["postcss-preset-env"],
        },
      },
    },
    loader,
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: isProduction ? path.resolve(__dirname, "../dist") : undefined,
    filename: isProduction
      ? "static/js/[name].[contenthash:10].js"
      : "static/js/[name].js",
    chunkFilename: isProduction
      ? "static/js/[name].[contenthash:10].js"
      : "static/js/[name].js",
    assetModuleFilename: "static/media/[hash:10][ext][query]",
    clean: true,
  },
  module: {
    rules: [
      // å¤„ç†css
      {
        test: /\.css$/,
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      // å¤„ç†å›¾ç‰‡
      {
        test: /\.(jpe?g|png|gif|webp|svg)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024,
          },
        },
      },
      // å¤„ç†å…¶ä»–èµ„æº
      {
        test: /\.(woff2?|ttf)/,
        type: "asset/resource",
      },
      {
        test: /\.jsx?$/,
        include: path.resolve(__dirname, "../src"),
        loader: "babel-loader",
        options: {
          cacheDirectory: true,
          cacheCompression: false,
          plugins: [!isProduction && "react-refresh/babel"].filter(Boolean),
        },
      },
    ],
  },
  plugins: [
    new EslintWebpackPlugin({
      extensions: [".js", ".jsx"],
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    isProduction &&
      new MiniCssExtractPlugin({
        filename: "static/css/[name].[contenthash:10].css",
        chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
      }),
    isProduction &&
      new CopyPlugin({
        patterns: [
          {
            from: path.resolve(__dirname, "../public"),
            to: path.resolve(__dirname, "../dist"),
            toType: "dir",
            noErrorOnMissing: true, // ä¸ç”Ÿæˆé”™è¯¯
            globOptions: {
              // å¿½ç•¥æ–‡ä»¶
              ignore: ["**/index.html"],
            },
            info: {
              // è·³è¿‡terserå‹ç¼©js
              minimized: true,
            },
          },
        ],
      }),
    !isProduction && new ReactRefreshWebpackPlugin(),
  ].filter(Boolean),
  mode: isProduction ? "production" : "development",
  devtool: isProduction ? "source-map" : "cheap-module-source-map",
  optimization: {
    splitChunks: {
      chunks: "all",
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
    minimize: isProduction,
    minimizer: [
      new CssMIniMizerWebpackPlugin(),
      new TerserWebpackPlugin(),
      new ImageMinimizerWebpackPlugin({
        minimizer: {
          implementation: ImageMinimizerWebpackPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
  },
  resolve: {
    extensions: [".jsx", ".js", ".json"],
  },
  devServer: {
    host: "localhost",
    port: 3000,
    open: true,
    hot: true,
    compress: true,
    historyApiFallback: true,
  },
};
```

### 1.5 ä¼˜åŒ–é…ç½®

```js
const path = require("path");
const EslintWebpackPlugin = require("eslint-webpack-plugin");
const HtmlWebpackPlugin = require("html-webpack-plugin");

const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMIniMizerWebpackPlugin = require("css-minimizer-webpack-plugin");
const TerserWebpackPlugin = require("terser-webpack-plugin");
const ImageMinimizerWebpackPlugin = require("image-minimizer-webpack-plugin");
const ReactRefreshWebpackPlugin = require("@pmmmwh/react-refresh-webpack-plugin");

const CopyPlugin = require("copy-webpack-plugin");

const isProduction = process.env.NODE_ENV === "production";

const getStyleLoaders = (loader) => {
  return [
    isProduction ? MiniCssExtractPlugin.loader : "style-loader",
    "css-loader",
    {
      loader: "postcss-loader",
      options: {
        postcssOptions: {
          plugins: ["postcss-preset-env"],
        },
      },
    },
    loader && {
      loader: loader,
      options:
        loader === "less-loader"
          ? {
              // antdçš„è‡ªå®šä¹‰ä¸»é¢˜
              lessOptions: {
                modifyVars: {
                  // å…¶ä»–ä¸»é¢˜è‰²ï¼šhttps://ant.design/docs/react/customize-theme-cn
                  "@primary-color": "#1DA57A", // å…¨å±€ä¸»è‰²
                },
                javascriptEnabled: true,
              },
            }
          : {},
    },
  ].filter(Boolean);
};

module.exports = {
  entry: "./src/main.js",
  output: {
    path: isProduction ? path.resolve(__dirname, "../dist") : undefined,
    filename: isProduction
      ? "static/js/[name].[contenthash:10].js"
      : "static/js/[name].js",
    chunkFilename: isProduction
      ? "static/js/[name].[contenthash:10].js"
      : "static/js/[name].js",
    assetModuleFilename: "static/media/[hash:10][ext][query]",
    clean: true,
  },
  module: {
    rules: [
      // å¤„ç†css
      {
        test: /\.css$/,
        use: getStyleLoaders(),
      },
      {
        test: /\.less$/,
        use: getStyleLoaders("less-loader"),
      },
      {
        test: /\.s[ac]ss$/,
        use: getStyleLoaders("sass-loader"),
      },
      {
        test: /\.styl$/,
        use: getStyleLoaders("stylus-loader"),
      },
      // å¤„ç†å›¾ç‰‡
      {
        test: /\.(jpe?g|png|gif|webp|svg)$/,
        type: "asset",
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024,
          },
        },
      },
      // å¤„ç†å…¶ä»–èµ„æº
      {
        test: /\.(woff2?|ttf)/,
        type: "asset/resource",
      },
      {
        test: /\.jsx?$/,
        include: path.resolve(__dirname, "../src"),
        loader: "babel-loader",
        options: {
          cacheDirectory: true,
          cacheCompression: false,
          plugins: [!isProduction && "react-refresh/babel"].filter(Boolean),
        },
      },
    ],
  },
  plugins: [
    new EslintWebpackPlugin({
      extensions: [".js", ".jsx"],
      context: path.resolve(__dirname, "../src"),
      exclude: "node_modules",
      cache: true,
      cacheLocation: path.resolve(
        __dirname,
        "../node_modules/.cache/.eslintcache"
      ),
    }),
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, "../public/index.html"),
    }),
    isProduction &&
      new MiniCssExtractPlugin({
        filename: "static/css/[name].[contenthash:10].css",
        chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
      }),
    isProduction &&
      new CopyPlugin({
        patterns: [
          {
            from: path.resolve(__dirname, "../public"),
            to: path.resolve(__dirname, "../dist"),
            toType: "dir",
            noErrorOnMissing: true, // ä¸ç”Ÿæˆé”™è¯¯
            globOptions: {
              // å¿½ç•¥æ–‡ä»¶
              ignore: ["**/index.html"],
            },
            info: {
              // è·³è¿‡terserå‹ç¼©js
              minimized: true,
            },
          },
        ],
      }),
    !isProduction && new ReactRefreshWebpackPlugin(),
  ].filter(Boolean),
  mode: isProduction ? "production" : "development",
  devtool: isProduction ? "source-map" : "cheap-module-source-map",
  performance: false,
  optimization: {
    splitChunks: {
      chunks: "all",
      cacheGroups: {
        react: {
          test: /[\\/]node_modules[\\/]react(.*)[\\/]/,
          name: "chunk-react",
          priority: 40,
        },
        antd: {
          test: /[\\/]node_modules[\\/]antd[\\/]/,
          name: "chunk-antd",
          priority: 30,
        },
        lib: {
          test: /[\\/]node_modules[\\/]/,
          name: "chunk-libs",
          priority: 20,
        },
        layouts: {
          name: "layouts",
          test: path.resolve(__dirname, "../src/layouts"),
          priority: 40,
        },
      },
    },
    runtimeChunk: {
      name: (entrypoint) => `runtime~${entrypoint.name}`,
    },
    minimize: isProduction,
    minimizer: [
      new CssMIniMizerWebpackPlugin(),
      new TerserWebpackPlugin(),
      new ImageMinimizerWebpackPlugin({
        minimizer: {
          implementation: ImageMinimizerWebpackPlugin.imageminGenerate,
          options: {
            plugins: [
              ["gifsicle", { interlaced: true }],
              ["jpegtran", { progressive: true }],
              ["optipng", { optimizationLevel: 5 }],
              [
                "svgo",
                {
                  plugins: [
                    "preset-default",
                    "prefixIds",
                    {
                      name: "sortAttrs",
                      params: {
                        xmlnsOrder: "alphabetical",
                      },
                    },
                  ],
                },
              ],
            ],
          },
        },
      }),
    ],
  },
  resolve: {
    extensions: [".jsx", ".js", ".json"],
  },
  devServer: {
    host: "localhost",
    port: 3000,
    open: true,
    hot: true,
    compress: true,
    historyApiFallback: true,
  },
};
```

### 1.6 å‘å¸ƒreact-cliè‡³npm

#### 1.6.1 é…ç½®é¡¹ç›®

1.åˆ é™¤`node_modules`

2.å°†`react-cli`æ”¹åä¸º`example`

3.åˆ›å»ºæ–‡ä»¶å¤¹`temp`

4.å°†`example`æ–‡ä»¶å¤¹ç§»å…¥`temp`å†…

5.`temp`å†…åˆ›å»ºæ–‡ä»¶å¤¹`bin`ï¼Œ`bin`å†…åˆ›å»º`myreact-cli.js`

> myreact-cli.js

```js
#!/usr/bin/env node
"use strict";

// å­—ä½“é¢œè‰² https://bj.96weixin.com/emoji/
const styles = {
  bold: "\x1B[1m%s\x1B[22m",
  italic: "\x1B[3m%s\x1B[23m",
  underline: "\x1B[4m%s\x1B[24m",
  inverse: "\x1B[7m%s\x1B[27m",
  strikethrough: "\x1B[9m%s\x1B[29m",
  white: "\x1B[37m%s\x1B[39m",
  grey: "\x1B[90m%s\x1B[39m",
  black: "\x1B[30m%s\x1B[39m",
  blue: "\x1B[34m%s\x1B[39m",
  cyan: "\x1B[36m%s\x1B[39m",
  green: "\x1B[32m%s\x1B[39m",
  magenta: "\x1B[35m%s\x1B[39m",
  red: "\x1B[31m%s\x1B[39m",
  yellow: "\x1B[33m%s\x1B[39m",
  whiteBG: "\x1B[47m%s\x1B[49m",
  greyBG: "\x1B[49;5;8m%s\x1B[49m",
  blackBG: "\x1B[40m%s\x1B[49m",
  blueBG: "\x1B[44m%s\x1B[49m",
  cyanBG: "\x1B[46m%s\x1B[49m",
  greenBG: "\x1B[42m%s\x1B[49m",
  magentaBG: "\x1B[45m%s\x1B[49m",
  redBG: "\x1B[41m%s\x1B[49m",
  yellowBG: "\x1B[43m%s\x1B[49m",
};

// å¯¼å…¥æ¨¡å—
const fs = require("fs");
const path = require("path");

// è·å–æ§åˆ¶å°å‚æ•°
let argv = process.argv;
let dirname = argv[2];

// æ‹·è´æ–‡ä»¶
if (dirname) {
  copyFile(path.dirname(__dirname) + `/example`, `${process.cwd()}/${dirname}`);
  console.log(styles["green"], `\nğŸ˜ğŸ˜ğŸ˜ $ cd ${dirname}`);
  console.log(styles["green"], `ğŸ˜ğŸ˜ğŸ˜ $ yarn`);
  console.log(styles["green"], `ğŸ˜ğŸ˜ğŸ˜ $ yarn dev \n`);
} else {
  console.log(styles["red"], "\nâŒè¯­æ³•é”™è¯¯ï¼Œè¯·è¾“å…¥é¡¹ç›®å ğŸ‘€ğŸ‘€ğŸ‘€ \n");
}

/**
 * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
 * @param {string} path è·¯å¾„
 */
function isExist(path) {
  if (!fs.existsSync(path)) {
    fs.mkdirSync(path);
  }
}

/**
 * æ‹·è´æ–‡ä»¶
 * @param {string} sourcePath è·¯å¾„
 * @param {string} targetPath è·¯å¾„
 */
function copyFile(sourcePath, targetPath) {
  isExist(targetPath);

  const sourceFile = fs.readdirSync(sourcePath, { withFileTypes: true });

  sourceFile.forEach((file) => {
    const newSourcePath = path.resolve(sourcePath, file.name);
    const newTargetPath = path.resolve(targetPath, file.name);
    if (file.isDirectory()) {
      isExist(newTargetPath);
      copyFile(newSourcePath, newTargetPath);
    } else {
      fs.copyFileSync(newSourcePath, newTargetPath);
    }
  });
}
```

6.åˆ›å»º`package.json`

```bash
npm init -y
```

ä¿®æ”¹`package.json`

æ³¨æ„ï¼šä»¥åæ¯æ¬¡ä¿®æ”¹ä¸Šç©¿`version`éƒ½è¦å¤§äºä¹‹å‰ç‰ˆæœ¬

```json
{
  "name": "react-cli-xiazhi",
  "version": "1.0.0",
  "description": "xiazhi my react cli",
  "bin": {
    "react-cli": "./bin/myreact-cli.js"
  },
  "directories": {
    "example": "example"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "react-cli-xiazhi": "^1.0.3"
  }
}
```

7.åˆ›å»ºé¡¹ç›®æè¿°æ–‡ä»¶

> README.md

```markdown
# react-cli-xiazhi

[![Build Status][travis-url]][travis-url]
[![MIT License][license-url]][license-url]
[![NPM downloads][npm-downloads-image]][npm-downloads-url]

# â¬‡ï¸ Install

> yarn add react-cli-xiazhi -g

# ğŸ¨ Usage

> æ­¥éª¤ 1ï¼š react-cli-xiazhi é¡¹ç›®å

> æ­¥éª¤ 2ï¼šæ ¹æ®æç¤ºè¿›å…¥ç›®å½•ä¸‹è½½æ¨¡å—å¯åŠ¨æµ‹è¯•

m-downloads-url]: https://npmcharts.com/compare/webopenfather-date?minimal=true

# ğŸ”’ License

See the LICENSE file for license rights and limitations (ISC).
```

8.æ•´ä½“é¡¹ç›®ç›®å½•

```
temp
â”œâ”€ bin
â”‚  â””â”€ myreact-cli.js
â”œâ”€ example
â”‚  â”œâ”€ .eslintrc.js
â”‚  â”œâ”€ babel.config.js
â”‚  â”œâ”€ package.json
â”‚  â”œâ”€ public
â”‚  â”‚  â”œâ”€ favicon.ico
â”‚  â”‚  â””â”€ index.html
â”‚  â”œâ”€ README.md
â”‚  â”œâ”€ src
â”‚  â”‚  â”œâ”€ App.jsx
â”‚  â”‚  â”œâ”€ main.js
â”‚  â”‚  â”œâ”€ pages
â”‚  â”‚  â”‚  â”œâ”€ About
â”‚  â”‚  â”‚  â”‚  â””â”€ index.jsx
â”‚  â”‚  â”‚  â”œâ”€ Antd
â”‚  â”‚  â”‚  â”‚  â””â”€ index.jsx
â”‚  â”‚  â”‚  â””â”€ Home
â”‚  â”‚  â”‚     â”œâ”€ index.jsx
â”‚  â”‚  â”‚     â””â”€ index.less
â”‚  â”‚  â””â”€ router
â”‚  â”‚     â””â”€ index.jsx
â”‚  â”œâ”€ webpack.config.js
â”‚  â””â”€ yarn.lock
â”œâ”€ package.json
â”œâ”€ README.md
â””â”€ yarn.lock
```



#### 1.6.2 å‘å¸ƒnpm

```bash
# 1.ä¿®æ”¹npmä¸ºå®˜æ–¹æºï¼Œè®°å¾—å‘å¸ƒå®Œä¹‹åæ”¹å›æ·˜å®æº
npm config set registry https://registry.npmjs.org/

# 2.ç™»å½•ï¼Œè¾“å…¥npmè´¦å·å¯†ç ï¼ˆå¯†ç ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼‰ï¼Œç­‰é‚®ç®±çš„éªŒè¯ç è¾“å…¥å®Œæˆå³ç™»å½•æˆåŠŸ
npm login

# 3.å‘å¸ƒ
npm publish
```



#### 1.6.3 æµ‹è¯•

1.ä¸‹è½½è„šæ‰‹æ¶,å…¨å±€å®‰è£…

```bash
npm i react-cli-xiazhi -g
```

2.åˆ›å»ºé¡¹ç›®

```bash
react-cli projectName
```

3.ä¸‹è½½ä¾èµ–

```bash
npm i 
```

4.è¿è¡Œ

```bash
npm run dev
```



