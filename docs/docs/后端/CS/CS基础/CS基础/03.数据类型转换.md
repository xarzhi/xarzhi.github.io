# 数据类型转换

## 1.隐式转换

当从一个取值范围**小**的数据类型转型为取值范围**大**的数据类型，系统会自动转换类型

```c++
int num=666;
double num1 = num;
```

上述num原本为`int`类型，但把num直接赋值给了`double`类型的num1，此时num1的值虽然也是666，但他是`double`类型的，这就完成了隐式转换

### 1.1 预定义隐式转换

下表显示内置数值类型之间的预定义隐式转换：

| From   | 到                                                           |
| :----- | :----------------------------------------------------------- |
| sbyte  | `short`、`int`、`long`、`float`、`double`、`decimal` 或 `nint`。 |
| byte   | `short`、`ushort`、`int`、`uint`、`long`、`ulong`、`float`、`double`、`decimal`、`nint` 或 `nuint` |
| short  | `int`、`long`、`float`、`double`、`decimal` 或 `nint`        |
| ushort | `int`、`uint`、`long`、`ulong`、`float`、`double`、`decimal`、`nint` 或 `nuint` |
| int    | `long`、`float`、`double`、`decimal` 或 `nint`               |
| uint   | `long`、`ulong`、`float`、`double`、`decimal` 或 `nuint`     |
| long   | `float`、`double` 或 `decimal`                               |
| ulong  | `float`、`double` 或 `decimal`                               |
| float  | `double`                                                     |
| nint   | `long`、`float`、`double` 或 `decimal`                       |
| nuint  | `ulong`、`float`、`double` 或 `decimal`                      |

:::tip 注意

从 `int`、`uint`、`long`、`ulong`、`nint` 或 `nuint` 到 `float` 的隐式转换以及从 `long`、`ulong`、`nint` 或 `nuint` 到 `double` 的隐式转换可能会丢失精准率，但绝不会丢失一个数量级。 其他隐式数值转换不会丢失任何信息。



另外注意：

- 任何[整型数值类型](https://learn.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/integral-numeric-types)都可以隐式转换为任何[浮点数值类型](https://learn.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/floating-point-numeric-types)。
- 不存在针对 `byte` 和 `sbyte` 类型的隐式转换。 不存在从 `double` 和 `decimal` 类型的隐式转换。
- `decimal` 类型和 `float` 或 `double` 类型之间不存在隐式转换。
- 类型 `int` 的常量表达式的值（例如，由整数文本所表示的值）如果在目标类型的范围内，则可隐式转换为 `sbyte`、`byte`、`short`、`ushort`、`uint`、`ulong`、`nint` 或 `nuint`：

:::





## 2.强制转换

当从一个取值范围**大**的数据类型转型为取值范围**小**的数据类型，我们需要手动通过一些操作完成转换

| From    | 到                                                           |
| :------ | :----------------------------------------------------------- |
| sbyte   | `byte`、`ushort`、`uint`、`ulong` 或 `nuint`                 |
| byte    | `sbyte`                                                      |
| short   | `sbyte`、`byte`、`ushort`、`uint`、`ulong` 或 `nuint`        |
| ushort  | `sbyte`、`byte` 或 `short`                                   |
| int     | `sbyte`、`byte`、`short`、`ushort`、`uint`、`ulong` 或 `nuint`。 |
| uint    | `sbyte`、`byte`、`short`、`ushort`、`int` 或 `nint`          |
| long    | `sbyte`、`byte`、`short`、`ushort`、`int`、`uint`、`ulong`、`nint` 或 `nuint` |
| ulong   | `sbyte`、`byte`、`short`、`ushort`、`int`、`uint`、`long`、`nint` 或 `nuint` |
| float   | `sbyte`、`byte`、`short`、`ushort`、`int`、`uint`、`long`、`ulong`、`decimal`、`nint` 或 `nuint` |
| double  | `sbyte`、`byte`、`short`、`ushort`、`int`、`uint`、`long`、`ulong`、`float`、`decimal`、`nint` 或 `nuint` |
| decimal | `sbyte`、`byte`、`short`、`ushort`、`int`、`uint`、`long`、`ulong`、`float`、`double`、`nint` 或 `nuint` |
| nint    | `sbyte`、`byte`、`short`、`ushort`、`int`、`uint`、`ulong` 或 `nuint` |
| nuint   | `sbyte`、`byte`、`short`、`ushort`、`int`、`uint`、`long` 或 `nint` |

### 2.1 ()转换法

以上表格规则可通过如下如法转换

```c++
float f = 1f;
int i = (int)f;
```



### 2.2 Parse()

`Parse()`方法是`int`类中的**静态方法**，该方式是**将数字内容的字符串**转换为int类型

```c++
public static int Parse (string s);
```

参数：

- s：数字类型的字符串，如`"12345"`

返回值：返回转换后的数字

```cs
string s = "456123";
int i = int.Parse(s);
```

其他`Parse()`重载参照https://learn.microsoft.com/zh-cn/dotnet/api/system.int32.parse?view=net-8.0

:::tip

除了int类，还有一些其他类也可以使用Parse()函数，如

```c++
public static float Parse (string s);
public static double Parse (string s);
public static decimal Parse (string s);
```

:::



### 2.3 TryParse()

`TryParse()`方法是`int`类中的**静态方法**，该方式也是**将数字内容的字符串转换为int类型**，但是该方式有比int.Parse优越的地方，就是它不会出现异常，最后一个参数result是

```cs
public static bool TryParse(string s, out int result)
```

参数：

- s：需要转换的字符串
- result：输出值，如果转换成功则输出相应的值，转换失败则输出0.

返回值：bool，返回成功还是失败

```cs
// 转换非数字
string s = "abc";
int a = 0;
bool b = int.TryParse(s, out a);

Console.WriteLine(a);   // 0
Console.WriteLine(b);	// false

// 转换数字
string s = "123456";
int a = 0;
bool b = int.TryParse(s, out a);

Console.WriteLine(a);   // 123456
Console.WriteLine(b);	// true
```

:::tip

除了int类，还有一些其他类也可以使用TryParse()函数，如

```c++
public static bool TryParse(string s, out int result)
public static bool TryParse(string s, out double result)
public static bool TryParse(string s, out decimal result)
```

:::



### 2.4 Convert.ToInt32()

Convert.ToInt32该方式不仅可以将字符串类型转换为int，还可以将其他类型转换为Int

```c++
public static int ToInt32(value)
```

参数：

- value：可以是内容为数字的string，也可以是其他整型

返回值：转化为数字的整型

```cs
int a=Convert.ToInt32("123");
int b=Convert.ToInt32(456f);
int c=Convert.ToInt32(789L);

Console.WriteLine(a);   // 123
Console.WriteLine(b);   // 456
Console.WriteLine(c);   // 789
```

注意：

- 变量若为object或string类型，当其值为Null时，如果转换成功则输出相应得值，转换失败则输出0，不会造成程序错误

  ```cs
  int a=Convert.ToInt32(null);
  Console.WriteLine(a);   // 0
  ```

- 但若是此string类型的值为string.Empty，转换成int时，程序仍会出错.

  ```cs
  int b = Convert.ToInt32(string.Empty);
  Console.WriteLine(b);   //  报错
  ```

- 该方式同强制类型转换一样在处理char类型的时候，返回的都是ASCII码

  ```cs
  int a=Convert.ToInt32('a');
  int A = Convert.ToInt32('A');
  
  Console.WriteLine(a);   // 97
  Console.WriteLine(A);   // 65
  ```



:::tip

Convert中包含一些其他的转换整形方法

| 数值类型  | 方法                                                         |
| :-------- | :----------------------------------------------------------- |
| `decimal` | [ToDecimal(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.todecimal#system-convert-todecimal(system-string)) |
| `float`   | [ToSingle(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.tosingle#system-convert-tosingle(system-string)) |
| `double`  | [ToDouble(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.todouble#system-convert-todouble(system-string)) |
| `short`   | [ToInt16(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.toint16#system-convert-toint16(system-string)) |
| `int`     | [ToInt32(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.toint32#system-convert-toint32(system-string)) |
| `long`    | [ToInt64(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.toint64#system-convert-toint64(system-string)) |
| `ushort`  | [ToUInt16(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.touint16#system-convert-touint16(system-string)) |
| `uint`    | [ToUInt32(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.touint32#system-convert-touint32(system-string)) |
| `ulong`   | [ToUInt64(String)](https://learn.microsoft.com/zh-cn/dotnet/api/system.convert.touint64#system-convert-touint64(system-string)) |

:::



### 2.5 ToString()

将指定的值转化为string，`ToString()`在许多类中都有重写

```cs
int a = 123456;
string b=a.ToString();
    
Console.WriteLine(a);   // "123456"

Console.WriteLine(456f.ToString());   // "456"
Console.WriteLine(789L.ToString());   // "789"
Console.WriteLine(1111M.ToString());   // "1111"
```

ToString()可以格式化日期

```c++
DateTime dateTime = DateTime.Now;

dateTime.ToString();									// 2016/9/27 00:00:00
dateTime.ToString("yyyy/MM/dd HH:mm:ss");				// 2016/09/27 00:00:00
dateTime.ToString("yyyy-MM-dd HH:mm:ss");				// 2016-09-27 00:00:00
dateTime.ToString("yyyy.MM.dd HH:mm:ss");				// 2016.09.27 00:00:00
dateTime.ToString("dd/MM/yyyy HH:mm:ss");				// 27/09/2016 00:00:00
dateTime.ToString("dd-MM-yyyy HH:mm:ss");				// 27-09-2016 00:00:00
dateTime.ToString（"yyyy年MM月dd日  HH时mm分ss秒")			// 2024年09月04日  04时37分58秒
dateTime.ToString("yyyy-MM-dd HH:mm:ss.fff"))			// 2016-09-27 01:02:03.001//fff越多精度越高
dateTime.ToString("yyyy-MM-dd HH:mm:ss:ms"))			// 2016-09-27 01:02:03:234
```

- y代表年份，注意是小写的y，大写的Y并不代表年份。
- M表示月份。
- d表示日期，注意D并不代表什么。
- h或H表示小时，h用的是12小时制，H用的是24小时制。
- m表示分钟。
- s表示秒。注意S并不代表什么。|



