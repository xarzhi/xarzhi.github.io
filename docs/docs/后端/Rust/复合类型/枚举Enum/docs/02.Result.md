

# Result

`Result<T, E>`也是一个特殊的枚举，用来表达一个结果**可能成功，也可能失败**。

Result在标准库中的定义如下：

```rust
pub enum Result<T, E> {
    Ok(T),
    Err(E),
}
```

泛型参数

- T：当结果为Ok时，返回的值的类型
- E：当结果为Err时，错误信息的类型

它有两个变体：

- `Ok(T)` 表示操作成功，携带一个结果值 `T`。
- `Err(E)` 表示操作失败，携带一个错误信息 `E`。



## 1.基本使用

`Result<T, E>` 枚举被包含在了 [`prelude`](https://course.rs/appendix/prelude.html)（**prelude 属于 Rust 标准库，Rust 会将最常用的类型、函数等提前引入其中，省得我们再手动引入**）之中，你不需要将其显式引入作用域。

另外，它的成员 `Ok` 和 `Err` 也是如此，无需使用 `Option::` 前缀就可直接使用 `Some` 和 `None`。

比如下面一段代码

```rust
let o: Result<i32, &str> = Result::Ok(123);
let e: Result<i32, &str> = Result::Err("Failed to read file");
```

完全可以去掉`Option::`，然后使用下面的方式

```rust
let o: Result<i32, &str> = Ok(123);
let e: Result<i32, &str> = Err("Failed to read file");
```





Result常用于一个io操作函数的返回值

```rust
fn read_file(path: &str) -> Result<String, &str> {
    match std::fs::read_to_string(path) {
        Ok(s) => Ok(s),
        Err(_) => Err("Failed to read file"),
    }
}
```



:::warning 注意

不管是定义一个Ok变量，还是Err变量，都需要显示声明泛型

```rust
let o: Result<i32, &str> = Result::Ok(123);
let e: Result<i32, &str> = Err("Failed to read file");
```

:::





## 2.模式匹配

对于一个Result，使用模式匹配来获取其结果是相当经典的

```rust
let o: Result<i32, &str> = Ok(123);

match o {
    Ok(value) => {
        println!("{}", value);
    }
    Err(err) => {
        println!("{}", err);
    }
}
```

- 若Result的结果为Ok，那么在match中，Ok包含的值就会被赋值给参数value
- 若Result的结果为Err，那么在match中，Err包含的值就会被赋值给参数err



### 2.1 if let

`if let`是`match`的语法糖，简化`Option`和`Result`的`match`语句先看如下代码

当我们只关注`Result`成功的结果，而不想去处理失败的结果时，使用if let是个好选择

```rust
let o: Result<i32, &str> = Ok(123);

if let Ok(x) = o {
    println!("{}", x);
}
```

`if let`语句将先判断变量是否是`Ok`变体，如果是，则把这个变量的值赋值给`Ok`的参数





### 2.4 ?运算符

`?`运算符：是Rust 中用于错误处理的简洁语法，主要作用是从函数中提前返回错误

- 它可以用在返回 Result或Option 类型的函数中
  - 成功时：解包 `Ok(T)`或 `Some(T)`中的值，程序继续执行 
  - 失败时：提早返回 `Err(E)`或 `None`，错误值会自动转换（若可能）

当一个返回Result的函数中使用了另一个返回`Result`的函数，使用`?`运算符可以减少`match`语句的使用

```rust {9-12}
fn divide(a: i32, b: i32) -> Result<i32, String> {
    if b == 0 {
        Err("除数不能为0".to_string())
    } else {
        Ok(a / b)
    }
}

fn get_divide(a: i32, b: i32) -> Result<i32, String> {
    divide(a, b)?;
    Ok(a / b)
}

fn main() {
    let res = get_divide(500, 100);
    match res {
        Ok(d) => println!("{}", d),
        Err(s) => println!("{}", s),
    }
}
```



## 3.方法

### impl<T, E> Result<T, E>

#### is_ok

判断一个self是否为Ok

```rust
pub const fn is_ok(&self) -> bool
```

**返回值**：

- 若`self`为`Ok`，则返回`true`
- 若`self`为`Err`，则返回`false`

```rust
let o: Result<i32, &str> = Ok(123);
let e: Result<i32, &str> = Err("error");

println!("{}",o.is_ok());   // true
println!("{}",e.is_ok());   // false
```

**源码**：

```rust
#[must_use = "if you intended to assert that this is ok, consider `.unwrap()` instead"]
#[rustc_const_stable(feature = "const_result_basics", since = "1.48.0")]
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub const fn is_ok(&self) -> bool {
    matches!(*self, Ok(_))
}
```



#### is_ok_and

先判断`self`是否是`Ok`变体，再返回谓词函数的返回值

```rust
pub fn is_ok_and(self, f: impl FnOnce(T) -> bool) -> bool
```

**参数**：

- **f**：谓词函数，返回`bool`值；若`self`为`Ok`，则把Ok中包含的值赋值给该函数的参数

**返回值**：

- 若`self`为`Ok`，则返回谓词函数的返回值
- 若`self`为`Err`，则直接返回`false`

```rust
// 当self为Ok
let o: Result<i32, &str> = Ok(123);

let res1 = o.is_ok_and(|x| {
    println!("{}", x); // 123
    if x > 100 { true } else { false }
});

println!("{}", res1); // true

// 当self为Err
let e: Result<i32, &str> = Err("error");
let res2 = e.is_ok_and(|x| {
    // 该函数不会执行
    println!("{}", x);
    true
});
println!("{}", res2); // false
```

**源码**：

```rust
#[must_use]
#[inline]
#[stable(feature = "is_some_and", since = "1.70.0")]
pub fn is_ok_and(self, f: impl FnOnce(T) -> bool) -> bool {
    match self {
        Err(_) => false,
        Ok(x) => f(x),
    }
}
```



#### is_err

判断self是否为`Err`变体

```rust
pub const fn is_err(&self) -> bool
```

**返回值**：

- 若`self`为`Err`变体，则返回`true`
- 若`self`为`Ok`变体，则返回`false`

```rust
let o: Result<i32, &str> = Ok(123);
let e: Result<i32, &str> = Err("error");

println!("{}", o.is_err()); // false
println!("{}", e.is_err()); // true
```

**源码**：

```rust
#[must_use = "if you intended to assert that this is err, consider `.unwrap_err()` instead"]
#[rustc_const_stable(feature = "const_result_basics", since = "1.48.0")]
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub const fn is_err(&self) -> bool {
    !self.is_ok()
}
```



#### is_err_and

先判断`self`是否是`Err`变体，在返回谓词函数的返回值

```rust
pub fn is_err_and(self, f: impl FnOnce(E) -> bool) -> bool
```

**参数**：

- **f**：谓词函数，返回`bool`值；若`self`为`Err`，则把`Err`中包含的错误信息赋值给该函数的参数

**返回值**：

- 若`self`为`Err`，则返回谓词函数的返回值
- 若`self`为`Ok`，则直接返回`false`

```rust
// 当self为Ok
let o: Result<i32, &str> = Ok(123);

let res1 = o.is_err_and(|x| {
    // 该函数不会执行
    println!("{}", x); 
    true
});

println!("{}", res1); // false

// 当self为Err
let e: Result<i32, &str> = Err("error");
let res2 = e.is_err_and(|x| {
    println!("{}", x);  // error
    true
});
println!("{}", res2); // true
```



源码：

```rust
#[must_use]
#[inline]
#[stable(feature = "is_some_and", since = "1.70.0")]
pub fn is_err_and(self, f: impl FnOnce(E) -> bool) -> bool {
    match self {
        Ok(_) => false,
        Err(e) => f(e),
    }
}
```



#### ok

把`Result<T, E>` 转换为`Option<T>`。

```rust
pub fn ok(self) -> Option<T>
```

**返回值**：返回一个`Option`

- 若`self`为`Ok`，则转换后的`Option`为`Some`，`Ok`中包含的值会赋值`Some`中的参数
- 若`self`为`Err`，则转换后的`Option`为`None`

```rust
// 当self为Ok
let o: Result<i32, &str> = Ok(123);
let option_some = o.ok();
println!("{:?}", option_some);      // Some(123)

// 当self为Err
let e: Result<i32, &str> = Err("error");
let option_none = e.ok();
println!("{:?}", option_none);      // None
```

源码：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn ok(self) -> Option<T> {
    match self {
        Ok(x) => Some(x),
        Err(_) => None,
    }
}
```



#### err

从 `Result<T, E>` 转换为 `Option<E>`。

```rust
pub fn err(self) -> Option<E>
```

**返回值**：返回一个`Option`

- 若`self`为`Err`，则转换后的`Option`为`Some`，`Err`中包含的值会赋值`Some`中的参数
- 若`self`为`Ok`，则转换后的`Option`为`None`

```rust
// 当self为Err
let e: Result<i32, &str> = Err("error");
let option_none = e.err();
println!("{:?}", option_none);      // Some("error")


// 当self为Ok
let o: Result<i32, &str> = Ok(123);
let option_some = o.err();
println!("{:?}", option_some);      // None
```

源码：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn err(self) -> Option<E> {
    match self {
        Ok(_) => None,
        Err(x) => Some(x),
    }
}
```



#### as_ref

从 `&Result<T, E>` 转换为 `Result<&T, &E>`。

产生一个新的 `Result`，其中包含对原始引用的引用，并将原始保留在原处。

获取内部值的**不可变引用**，不获取所有权，原`Result`仍可用

```rust
pub const fn as_ref(&self) -> Result<&T, &E>
```

**返回值**：返回一个新的`Result`，不获取原`Result`的所有权

```rust
let o: Result<String, &str> = Ok(String::from("123"));

match o.as_ref() {
    Ok(value) => println!("{}", value),
    Err(err) => println!("{}", err),
}

// 此时o仍可用
println!("{:?}", o); // Ok(123)
```

若不使用`as_ref()`

```rust
let o: Result<String, &str> = Ok(String::from("123"));

match o {
    Ok(value) => println!("{}", value),
    Err(err) => println!("{}", err),
}

// 此时会报错 borrow of partially moved value: `o`
println!("{:?}", o); 
```

:::tip 注意

上面示例选用`String`类型作为Ok的值，因为String在模式匹配中会发生移动

若选用`i32`等基础类型，则模式匹配只会发生复制(copy)，这时候`match`中`Ok`的值和原先的`Ok`的值就没关系了

下面的`as_mut`函数也是一个道理

:::

**源码**：

```rust
#[inline]
#[rustc_const_stable(feature = "const_result_basics", since = "1.48.0")]
#[stable(feature = "rust1", since = "1.0.0")]
pub const fn as_ref(&self) -> Result<&T, &E> {
    match *self {
        Ok(ref x) => Ok(x),
        Err(ref x) => Err(x),
    }
}
```



#### as_mut

从 `&Result<T, E>` 转换为 `Result<&mut T, &mut E>`。

产生一个新的 `Result`，其中包含对原始引用的引用

获取内部值的**可变引用**，不获取所有权，**允许修改内部值**

```rust
pub fn as_mut(&mut self) -> Result<&mut T, &mut E>
```

**返回值**：返回一个新的`Result`，允许修改内部值，且**会一块修改原先`Result`中的值**

```rust
let mut o: Result<String, &str> = Ok(String::from("123"));

match o.as_mut() {
    Ok(value) => {
        value.push_str("456");
        println!("{:?}", value); // "123456"
    }
    Err(err) => println!("{}", err),
}

// 此处o仍可用，且被同步修改
println!("{:?}", o); // Ok("123456")
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
#[rustc_const_unstable(feature = "const_result", issue = "82814")]
pub const fn as_mut(&mut self) -> Result<&mut T, &mut E> {
    match *self {
        Ok(ref mut x) => Ok(x),
        Err(ref mut x) => Err(x),
    }
}
```



#### map

处理 `Ok`值；遇到 `Err`时直接返回默认值。

```rust
pub fn map<U, F>(self, op: F) -> Result<U, E>
where
    F: FnOnce(T) -> U,
```

**参数**：

- **op**：一个闭包函数，若`self`为`Ok`，则会把`Ok`中的值移动给`op`的参数，最后`map`会把`op`函数的返回值包裹上`Ok`并返回

**返回值**：

- 若`self`为`Ok`，则返回被`op`函数处理过内部值的`Ok`
- 若`self`为`Err(err)`，则直接返回`Err(err)`

```rust
// 当self为Ok
let o: Result<String, &str> = Ok(String::from("hello"));

let res: Result<String, &str> = o.map(|mut x| {
    x.push_str("world");
    x
});

println!("{:?}", res); // Ok("helloworld")

// d
let e: Result<String, &str> = Err("error");

let res: Result<String, &str> = e.map(|x| {
    // 该函数不会执行
    x
});

println!("{:?}", res); // Err("error")
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn map<U, F: FnOnce(T) -> U>(self, op: F) -> Result<U, E> {
    match self {
        Ok(t) => Ok(op(t)),
        Err(e) => Err(e),
    }
}
```



#### map_or

提供一个默认值，如果self为Ok，则返回闭包函数处理后的值，否则返回默认值

```rust
pub fn map_or<U, F>(self, default: U, f: F) -> U
where
    F: FnOnce(T) -> U,
```

**参数**：

- **default**：当`self`为`None`时，返回的默认值
- **f**：当`self`为`Ok`时，`Ok`中的值会被移动给`f`函数的参数，在函数中可根据这个值进行处理，最后`map_or`会返回这个函数的返回值

**返回值**：

- 当`self`为`None`时，返回参数`default`的值
- 当`self`为`Ok`时，返回`f`函数的返回值

```rust
// 当self为Ok
let o: Result<i32, &str> = Ok(100);

let res = o.map_or(-1, |x| x * 2);

println!("{:?}", res); // 200

// 当self为Err
let o: Result<i32, &str> = Err("error");

let res = o.map_or(-1, |x| x * 2);

println!("{:?}", res); // -1
```

源码：

```rust
#[inline]
#[stable(feature = "result_map_or", since = "1.41.0")]
pub fn map_or<U, F: FnOnce(T) -> U>(self, default: U, f: F) -> U {
    match self {
        Ok(t) => f(t),
        Err(_) => default,
    }
}
```



#### map_or_else

如果`self`为`Ok`，则可通过闭包函数`f`处理并返回

如果`self`为`Err`，则返回`default`函数的返回值

```rust
pub fn map_or_else<U, D, F>(self, default: D, f: F) -> U
where
    D: FnOnce(E) -> U,
    F: FnOnce(T) -> U,
```

**参数**：

- default：一个闭包函数；当`self`为`Err`时，`Err`中的错误信息会传递给`default`的参数，最后`default`的返回值会作为`map_or_else`函数为Err时的默认值
- f：一个闭包函数；当`self`为`Ok`时，`Ok`中的值会被移动给`f`函数的参数，在函数中可根据这个值进行处理，最后`map_or_else`会返回这个函数的返回值

**返回值**：

- 当`self`为`Ok`时，返回f闭包函数的返回值
- 当`self`为`Err`时，返回`default`闭包函数的返回值

```rust
// 当self为Ok
let o: Result<i32, &str> = Ok(100);

let res = o.map_or_else(|x| -1, |x| x * 2);

println!("{:?}", res); // 200


// 当self为Err
let o: Result<i32, &str> = Err("error");
let res = o.map_or_else(
    |str| {
        println!("{}", str);
        -1
    },
    |x| x * 2,
);

println!("{:?}", res); // -1
```

源码：

```rust
#[inline]
#[stable(feature = "result_map_or_else", since = "1.41.0")]
pub fn map_or_else<U, D: FnOnce(E) -> U, F: FnOnce(T) -> U>(self, default: D, f: F) -> U {
    match self {
        Ok(t) => f(t),
        Err(e) => default(e),
    }
}
```



#### map_err

处理Err的错误信息，保持Ok不变

```rust
pub fn map_err<F, O>(self, op: O) -> Result<T, F>
where
    O: FnOnce(E) -> F,
```

**参数**：

- op：一个闭包函数：用于处理Err中的错误信息

**返回值**：

- 若`self`为`Ok`，则将`Ok`原样返回
- 若`self`为`Err`，则把`Err`中的错误信息传递给`op`函数的参数，最后返回处理后的`Err`

```rust
let o: Result<i32, String> = Err("error".to_string());

let res: Result<i32, String> = o.map_err(|mut str| {
    println!("错误信息：{}", str); // 错误信息：error
    str.push_str(" message"); 
    str
});
println!("{:?}", res); //  Err("error message")
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn map_err<F, O: FnOnce(E) -> F>(self, op: O) -> Result<T, F> {
    match self {
        Ok(t) => Ok(t),
        Err(e) => Err(op(e)),
    }
}
```



#### inspect

以引用的方式接受`Ok`的值，并传入闭包函数中，最后返回`self`方便链式调用

```rust
pub fn inspect<F>(self, f: F) -> Result<T, E>
where
    F: FnOnce(&T),
```

**参数**：

- **f**：一个闭包函数，可以访问`self`中`Ok`的参数

**返回值**：返回`self`，方便链式调用

```rust
let o: Result<i32, String> = Ok(100);

let res = o
.inspect(|x| {
    println!("{}", x); // 100
})
.map(|x| x * 2);

println!("{:?}", res)       // Ok(200)
```

源码：

```rust
#[inline]
#[unstable(feature = "result_option_inspect", issue = "91345")]
pub fn inspect<F: FnOnce(&T)>(self, f: F) -> Self {
    if let Ok(ref t) = self {
        f(t);
    }

    self
}
```



#### inspect_err

和`inspect`相反，以引用的方式接受`Err`的值，并传入闭包函数中，最后返回self方便链式调用

```rust
pub fn inspect_err<F>(self, f: F) -> Result<T, E>
where
    F: FnOnce(&E),
```

**参数**：

- **f**：一个闭包函数，可以访问`self`中`Err`的参数

**返回值**：返回`self`，方便链式调用

```rust
let o: Result<i32, String> = Err("错误".to_string());

let res = o
.inspect_err(|err| {
    println!("{}", err); // 错误
})
.map(|x| x * 2);

println!("{:?}", res) // Err("错误")
```

**源码**：

```rust
#[inline]
#[unstable(feature = "result_option_inspect", issue = "91345")]
pub fn inspect_err<F: FnOnce(&E)>(self, f: F) -> Self {
    if let Err(ref e) = self {
        f(e);
    }

    self
}
```



#### as_deref

用于便捷地获取内部数据的引用

从 `Result<T, E>` (或 `&Result<T, E>`) 转换为 `Result<&<T as Deref>::Target, &E>`。

通过 `Deref` 强制转换原始 `Result` 的 `Ok` 变体，并返回新的 `Result`。

`as_deref()`能让你直接访问到其内部数据的不可变引用，而无需手动处理引用和解引用。

```rust
pub fn as_deref(&self) -> Result<&<T as Deref>::Target, &E>
where
    T: Deref,
```

**返回值**：返回一个新的Result，包含内部数据的**不可变引用**

```rust
let x: Result<String, u32> = Ok("hello".to_string());
let y: Result<&str, &u32> = Ok("hello");
assert_eq!(x.as_deref(), y);

let x: Result<String, u32> = Err(42);
let y: Result<&str, &u32> = Err(&42);
assert_eq!(x.as_deref(), y);
```

**源码**：

```rust
#[inline]
#[stable(feature = "inner_deref", since = "1.47.0")]
pub fn as_deref(&self) -> Result<&T::Target, &E>
where
	T: Deref,
{
    self.as_ref().map(|t| t.deref())
}
```



#### as_deref_mut

用于获取内部数据的**可变引用**

从 `Result<T, E>` (或 `&mut Result<T, E>`) 转换为 `Result<&mut <T as DerefMut>::Target, &mut E>`。

通过 `DerefMut` 强制转换原始 `Result` 的 `Ok` 变体，并返回新的 `Result`。

```rust
pub fn as_deref_mut(&mut self) -> Result<&mut <T as Deref>::Target, &mut E>
where
    T: DerefMut,
```

**返回值**：返回一个新的Result，包含内部数据的**可变引用**

源码：

```rust
#[inline]
#[stable(feature = "inner_deref", since = "1.47.0")]
pub fn as_deref_mut(&mut self) -> Result<&mut T::Target, &mut E>
where
	T: DerefMut,
{
    self.as_mut().map(|t| t.deref_mut())
}
```



#### iter

返回一个迭代器，调用`next()`返回一个`Option`

```rust
pub fn iter(&self) -> Iter<'_, T> 
```

**返回值**：返回一个迭代器

- 若`self`为`Ok`，则调用迭代器的`next()`方法返回`Some`，`Some`中的值即为`Ok`中的值
- 若`self`为`Err`，则调用迭代器的`next()`方法返回`None`

```rust
// 当self为Ok
let o: Result<i32, String> = Ok(123);

let res = o.iter().next();

println!("{:?}", res); // Some(123)


// 当self为Err
let o: Result<i32, String> = Err("123".to_string());

let res = o.iter().next();

println!("{:?}", res); // None
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn iter(&self) -> Iter<'_, T> {
    Iter { inner: self.as_ref().ok() }
}
```



#### iter_mut

返回一个迭代器，调用`next()`返回一个`Option`，包含对self中值的**可变引用**

```rust
pub fn iter_mut(&mut self) -> IterMut<'_, T> 
```

**返回值**：返回一个迭代器

- 若`self`为`Ok`，则调用迭代器的`next()`方法返回`Some`，`Some`中的值即为`Ok`中的值
- 若`self`为`Err`，则调用迭代器的`next()`方法返回`None`

```rust
x // 当self为Ok
let mut o: Result<i32, String> = Ok(123);

let mut res = o.iter_mut();

match res.next() {
    Some(value) => println!("{}", value), // 123
    None => (),
}

// 当self为Err
let mut o: Result<i32, String> = Err("error".to_string());

let mut res = o.iter_mut();

println!("{:?}", res.next())       // None
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn iter_mut(&mut self) -> IterMut<'_, T> {
    IterMut { inner: self.as_mut().ok() }
}
```



#### expect

如果`self`为`Err`，可以自定义出现`panic`时的的信息

```rust
pub fn expect(self, msg: &str) -> T
where
    E: Debug,
```

**参数**：

- **msg**：当`self`为`Err`时，自定义`panic`的字符串

**返回值**：

- 若`self`为`Ok`，则正常返回`Ok`
- 若`self`为`Err`，则panic，且信息为自己定义的字符串

```rust
let o: Result<i32, String> = Err("error".to_string());

let res = o.expect("我了个豆啊");           // panic   我了个豆啊: "error"
```

源码：

```rust
#[inline]
#[track_caller]
#[stable(feature = "result_expect", since = "1.4.0")]
pub fn expect(self, msg: &str) -> T
where
	E: fmt::Debug,
{
    match self {
        Ok(t) => t,
        Err(e) => unwrap_failed(msg, &e),
    }
}
```





#### expext_err

用于提取 `Result`中的错误值，当结果为 `Ok`时会导致程序 `panic`并显示提供的错误消息。

```rust
pub fn expect_err(self, msg: &str) -> E
where
    T: Debug,
```

**参数**：

- msg：自定义的错误信息

**返回值**：

- 若`self`为`Ok`，则`panic`
- 若`self`为`Err`，则返回错误信息

```rust
// 当self为Err时
let o: Result<i32, String> = Err("error".to_string());

let res = o.expect_err("我了个豆啊"); 

println!("{}", res)         // error

// 当self为Ok时
let o: Result<i32, String> = Ok(123);

let res = o.expect_err("我了个豆啊");       // panic 我了个豆啊: 123
```

**源码**：

```rust
#[inline]
#[track_caller]
#[stable(feature = "result_expect_err", since = "1.17.0")]
pub fn expect_err(self, msg: &str) -> E
where
	T: fmt::Debug,
{
    match self {
        Ok(t) => unwrap_failed(msg, &t),
        Err(e) => e,
    }
}
```



#### unwrap_err

返回包含 `self` 值的包含的 `Err`值。

如果值为 `Ok`，就会出现 panics，其中 panic 消息包括传递的消息以及`Ok`的内容。

```rust
pub fn unwrap_err(self) -> E
where
    T: Debug,
```

**返回值**：

- 若self为Ok，则程序会panic，且panic的消息为Ok的值
- 若self为Err，则返回Err中的错误信息

```rust
// 当self为Ok
let o: Result<String, String> = Ok("这是第一次做你滴老爸".to_string());

let res = o.unwrap_err(); // panic called `Result::unwrap_err()` on an `Ok` value: "这是第一次做你滴老爸"

// 当self为Err
let o: Result<String, String> = Err("我的心情也有些复杂".to_string());

let res = o.unwrap_err();

println!("{}", res) // 我的心情也有些复杂
```

**源码**：

```rust
#[inline]
#[track_caller]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn unwrap_err(self) -> E
where
	T: fmt::Debug,
{
    match self {
        Ok(t) => unwrap_failed("called `Result::unwrap_err()` on an `Ok` value", &t),
        Err(e) => e,
    }
}
```



#### into_ok



```rust
pub fn into_ok(self) -> T
where
    E: Into<!>,
```

**参数**：

**返回值**：

源码：

```rust
#[unstable(feature = "unwrap_infallible", reason = "newly added", issue = "61695")]
#[inline]
pub fn into_ok(self) -> T
where
	E: Into<!>,
{
    match self {
        Ok(x) => x,
        Err(e) => e.into(),
    }
}
```



#### into_err



```rust
pub fn into_err(self) -> E
where
    T: Into<!>,
```

**参数**：

**返回值**：

源码：

```rust
#[unstable(feature = "unwrap_infallible", reason = "newly added", issue = "61695")]
#[inline]
pub fn into_err(self) -> E
where
	T: Into<!>,
{
    match self {
        Ok(x) => x.into(),
        Err(e) => e,
    }
}
```



#### and

如果结果为 `Ok`，则返回自己提供的Result，否则，返回 `self` 的 `Err` 值。

```rust
pub fn and<U>(self, res: Result<U, E>) -> Result<U, E>
```

**参数**：

- **res**：一个`Result`，当`self`为`Ok`时被返回

**返回值**：

- 当`self`为`Ok`时，返回`res`
- 当`self`为`Err`时，返回`self`的`Err`

```rust
// 当self为Ok，res参数为Ok
let o: Result<i32, &str> = Ok(123);
let res = o.and(Ok(456));
println!("{:?}", res); // Ok(456)

// 当self为Ok，res参数为Err
let o: Result<i32, &str> = Ok(123);
let res: Result<i32, &str> = o.and(Err("error"));
println!("{:?}", res); // Err("error")

// 当self为Err，res参数为Ok
let o: Result<i32, &str> = Err("error");
let res: Result<i32, &str> = o.and(Ok(123));
println!("{:?}", res); // Err("error")

// 当self为Err，res参数为Err
let o: Result<i32, &str> = Err("error");
let res: Result<i32, &str> = o.and(Err("error123"));
println!("{:?}", res); // Err("error")
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn and<U>(self, res: Result<U, E>) -> Result<U, E> {
    match self {
        Ok(_) => res,
        Err(e) => Err(e),
    }
}
```



#### and_then

若self为Ok，则返回回调的返回值，否则返回self的Err

```rust
pub fn and_then<U, F>(self, op: F) -> Result<U, E>
where
    F: FnOnce(T) -> Result<U, E>,
```

**参数**：

- **op**：一个闭包函数，当`self`为`Ok`时，`Ok`包含的值会传递给`op`的参数，最后`and_then`返回这个函数的返回值

**返回值**：

- 当`self`为`Ok`时，返回`op`的返回值
- 当`self`为`Err`时，返回`self`的`Err`

```rust
// 当self为Ok，res参数为Ok
let o: Result<i32, &str> = Ok(100);
let res: Result<i32, &str> = o.and_then(|x| Ok(x * 2));
println!("{:?}", res); // Ok(200)

// 当self为Ok，res参数为Err
let o: Result<i32, &str> = Ok(123);
let res: Result<i32, &str> = o.and_then(|x| Err("error"));
println!("{:?}", res); // Err("error")

// 当self为Err，res参数为Ok
let o: Result<i32, &str> = Err("error");
let res: Result<i32, &str> = o.and_then(|x| Ok(x * 2));
println!("{:?}", res); // Err("error")

// 当self为Err，res参数为Err
let o: Result<i32, &str> = Err("error");
let res: Result<i32, &str> = o.and_then(|x| Err("error"));
println!("{:?}", res); // Err("error")
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn and_then<U, F>(self, op: F) -> Result<U, E> 
where
	F: FnOnce(T) -> Result<U, E>
{
    match self {
        Ok(t) => op(t),
        Err(e) => Err(e),
    }
}
```



#### or

如果self为 `Err`，则返回传入的`Result`; 否则，返回 `self` 的 `Ok` 值。

```rust
pub fn or<F>(self, res: Result<T, F>) -> Result<T, F>
```

**参数**：

- **res**：一个`Result`，当`self`为`Err`时被返回

**返回值**：

- 当`self`为`Ok`时，返回`Ok`自身
- 当`self`为`Err`时，返回`res`

```rust
// 当self为Ok
let o: Result<i32, &str> = Ok(100);
let res: Result<i32, &str> = o.or(Ok(666));
println!("{:?}", res); // Ok(100)

// 当self为Err
let o: Result<i32, &str> = Err("error");
let res: Result<i32, &str> = o.or(Ok(666));
println!("{:?}", res); // Ok(666)
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn or<F>(self, res: Result<T, F>) -> Result<T, F> {
    match self {
        Ok(v) => Ok(v),
        Err(_) => res,
    }
}
```



#### or_else

如果结果为 `Err`，则调用 `op`并返回`op`的返回值，否则返回 `self` 的 `Ok` 值。

```rust
pub fn or_else<F, O>(self, op: O) -> Result<T, F>
where
    O: FnOnce(E) -> Result<T, F>,
```

**参数**：

- **op**：一个闭包回调，当`self`为`Err`时，`Err`的错误信息会传递给`op`函数的参数，最后`or_else`返回`op`的返回值

**返回值**：

- 当`self`为`Ok`时，返回`Ok`自身
- 当`self`为`Err`时，返回`op`的返回值

```rust
// 当self为Ok
let o: Result<i32, &str> = Ok(100);
let res: Result<i32, &str> = o.or_else(|x| Ok(666));
println!("{:?}", res); // Ok(100)

// 当self为Err
let o: Result<i32, &str> = Err("error");
let res: Result<i32, &str> = o.or_else(|x| Ok(666));
println!("{:?}", res); // Ok(666)
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn or_else<F, O: FnOnce(E) -> Result<T, F>>(self, op: O) -> Result<T, F> {
    match self {
        Ok(t) => Ok(t),
        Err(e) => op(e),
    }
}
```



#### unwrap

取出`Ok`中的值并返回，若`self`为`Err`，则会导致`panic`

```rust
pub fn unwrap(self) -> T
where
    E: Debug,
```

**返回值**：

- 若`self`为`Ok`，则返回`OK`中的值
- 若`self`为`Err`，则程序`panic`

```rust
// self为Ok
let o: Result<i32, &str> = Ok(100);
let res = o.unwrap();
println!("{}", res); // 100

// self为Err
let o: Result<i32, &str> = Err("error");
let res = o.unwrap(); // panic
```

**源码**：

```rust
#[inline]
#[track_caller]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn unwrap(self) -> T
where
	E: fmt::Debug,
{
    match self {
        Ok(t) => t,
        Err(e) => unwrap_failed("called `Result::unwrap()` on an `Err` value", &e),
    }
}
```



#### unwrap_or

```rust
pub fn unwrap_or(self, default: T) -> T
```

**参数**：

- `default`：当`self`为`Err`时，被返回的默认值

**返回值**：

- 当`self`为`Ok`时，返回`Ok`中包含的值
- 当`self`为`Err`，返回传入的默认值

源码：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn unwrap_or(self, default: T) -> T {
    match self {
        Ok(t) => t,
        Err(_) => default,
    }
}
```



#### unwrap_or_default

取出`Ok`中的值并返回，若`self`为`Err`，则返回`T`类型的默认值

```rust
pub fn unwrap_or_default(self) -> T
where
    T: Default,
```

**返回值**：

- 若`self`为`Ok`，则返回`OK`中的值
- 若`self`为`Err`，则返回`Ok`中值的类型的默认值，比如`i32`的默认值为`0`

```rust
// self为Ok
let o: Result<i32, &str> = Ok(100);
let res = o.unwrap_or_default();
println!("{}", res); // 100

// self为Err
let o: Result<i32, &str> = Err("error");
let res = o.unwrap_or_default();
println!("{}", res); // 0
```

**源码**：

```rust
#[inline]
#[stable(feature = "result_unwrap_or_default", since = "1.16.0")]
pub fn unwrap_or_default(self) -> T
where
	T: Default,
{
    match self {
        Ok(x) => x,
        Err(_) => Default::default(),
    }
}
```





#### unwrap_or_else

```rust
pub fn unwrap_or_else<F>(self, op: F) -> T
where
    F: FnOnce(E) -> T,
```

**参数**：

- **op**：一个闭包函数，当`self`为`Err`时，会将`Err`的错误信息传递给这个函数的参数

**返回值**：

- 若`self`为`Ok`，则返回`OK`中的值
- 若`self`为`Err`，则把`Err`中的错误信息传递给`op`的参数，最后返回`op`函数的返回值

```rust
// self为Ok
let o: Result<i32, &str> = Ok(100);
let res = o.unwrap_or_else(|e| 200);
println!("{}", res); // 100

// self为Err
let o: Result<i32, &str> = Err("error");
let res = o.unwrap_or_else(|e| if e == "error" { 200 } else { 300 });
println!("{}", res); // 200
```

**源码**：

```rust
#[inline]
#[stable(feature = "rust1", since = "1.0.0")]
pub fn unwrap_or_else<F: FnOnce(E) -> T>(self, op: F) -> T {
    match self {
        Ok(t) => t,
        Err(e) => op(e),
    }
}
```



#### unwrap_unchecked

在不检查`self`是否为`Err`的情况下，直接取出`Ok`中的值，如果`self`为`E`rr，则会报错

使用`unwrap_unchecked`需要包含在`unsafe`块中，并且百分之百确定 `Result`是 `Ok`

```rust
pub unsafe fn unwrap_unchecked(self) -> T
```

**返回值**：

- 若`self`为`Ok`，则返回`OK`中的值
- 若`self`为`Err`，则程序会`panic`

```rust
// self为Ok
let o: Result<i32, &str> = Ok(100);
let res = unsafe { o.unwrap_unchecked() };
println!("{}", res); // 100

// self为Err
let o: Result<i32, &str> = Err("error");
let res = unsafe { o.unwrap_unchecked() };      // panic
```

**源码**：

```rust
#[inline]
#[track_caller]
#[stable(feature = "option_result_unwrap_unchecked", since = "1.58.0")]
pub unsafe fn unwrap_unchecked(self) -> T {
    debug_assert!(self.is_ok());
    match self {
        Ok(t) => t,
        // SAFETY: 调用者必须坚持安全保证。
        Err(_) => unsafe { hint::unreachable_unchecked() },
    }
}
```



#### unwrap_err_unchecked

在不检查`self`是否为`Ok`的情况下，直接取出`Err`中的错误信息，如果`self`为`Ok`，则会报错

使用`unwrap_unchecked`需要包含在`unsafe`块中，并且百分之百确定 `Result`是 `Err`

```rust
pub unsafe fn unwrap_err_unchecked(self) -> E
```

**返回值**：

- 若`self`为`Ok`，则程序会`panic`
- 若`self`为`Err`，则返回`Err`的错误信息

```rust
// self为Err
let o: Result<i32, &str> = Err("error");
let res = unsafe { o.unwrap_err_unchecked() }; // panic
println!("{}", res); // 100

// self为O
let o: Result<i32, &str> = Ok(100);
let res = unsafe { o.unwrap_err_unchecked() };
println!("{}", res); // 100
```

**源码**：

```rust
#[inline]
#[track_caller]
#[stable(feature = "option_result_unwrap_unchecked", since = "1.58.0")]
pub unsafe fn unwrap_err_unchecked(self) -> E {
    debug_assert!(self.is_err());
    match self {
        // SAFETY: 调用者必须坚持安全保证。
        Ok(_) => unsafe { hint::unreachable_unchecked() },
        Err(e) => e,
    }
}
```



### impl<T, E> Result<&T, E>

#### copied

当`Ok`中的值为**基本数据类型**时，可用此方法

用于返回`Ok`中值的**不可变借用**

```rust
pub fn copied(self) -> Result<T, E>
where
    T: Copy,
```

**返回值**：

- 当`self`为`Ok`时，返回`Ok`中值的**不可变借用**
- 当`self`为`Err`时，正常返回错误信息

```rust
// 当self为Ok
let num: i32 = 123;
let o: Result<&i32, &str> = Ok(&num);
let res = o.copied();
println!("{:?}", res); // Ok(123)

// 当self为Err
let str: &str = "error";
let o: Result<&i32, &str> = Err(&str);
let res = o.copied();
println!("{:?}", res); // Err("error")
```

**源码**：

```rust
#[inline]
#[stable(feature = "result_copied", since = "1.59.0")]
pub fn copied(self) -> Result<T, E>
where
	T: Copy,
{
    self.map(|&t| t)
}
```



#### cloned

当`Ok`中的值为**复合类型**时，可用此方法

用于返回`Ok`中值的**不可变借用**

```rust
pub fn cloned(self) -> Result<T, E>
where
    T: Clone,
```

**返回值**：

- 当`self`为`Ok`时，返回`Ok`中值的**不可变借用**
- 当`self`为`Err`时，正常返回错误信息

```rust
let str = (1, 2);
let o: Result<(i32, i32), &str> = Ok(str);
let res = o.clone();
println!("{:?}", res); // Ok((1, 2))
```

**源**码：

```rust
#[inline]
#[stable(feature = "result_cloned", since = "1.59.0")]
pub fn cloned(self) -> Result<T, E>
where
	T: Clone,
{
    self.map(|t| t.clone())
}
```



### impl<T, E> Result<&mut T, E>

#### copied

当`Ok`中的值为**基本数据类型**时，可用此方法

用于返回`Ok`中值的**可变借用**

```rust
pub fn copied(self) -> Result<T, E>
where
    T: Copy,
```

**返回值**：

- 当`self`为`Ok`时，返回`Ok`中值的**可变借用**
- 当`self`为`Err`时，正常返回错误信息

```rust
// 当self为Ok
let mut num: i32 = 100;
let o: Result<&i32, &str> = Ok(&mut num);
if let Ok(mut value) = o.copied() {
    value = value * 2;          // 可以被修改
    println!("{}", value)
}
```

**源码**：

```rust
#[inline]
#[stable(feature = "result_copied", since = "1.59.0")]
pub fn copied(self) -> Result<T, E>
where
	T: Copy,
{
    self.map(|&mut t| t)
}
```



#### cloned

当`Ok`中的值为**复合类型**时，可用此方法

用于返回`Ok`中值的**可变借用**

```rust
pub fn cloned(self) -> Result<T, E>
where
    T: Clone,
```

**返回值**：

- 当`self`为`Ok`时，返回`Ok`中值的**可变借用**
- 当`self`为`Err`时，正常返回错误信息

```rust
// 当self为Ok
let mut tu: (i32, i32) = (11, 22);
let o: Result<&(i32, i32), &str> = Ok(&mut tu);
if let Ok(mut value) = o.copied() {
    value.0 = 33; // 可以被修改
    value.1 = 44; // 可以被修改

    println!("{:?}", value)
}
```

**源码**：

```rust
#[inline]
#[stable(feature = "result_cloned", since = "1.59.0")]
pub fn cloned(self) -> Result<T, E>
where
	T: Clone,
{
    self.map(|t| t.clone())
}
```



### impl<T, E> Result<Option\<T>, E>

#### transpose

将包含`Option`的`Result`转换成包含`Result`的`Option`

`Ok(None)` 将映射到 `None`。 `Ok(Some(_))` 和 `Err(_)` 将映射到 `Some(Ok(_))` 和 `Some(Err(_))`。

```rust
pub fn transpose(self) -> Option<Result<T, E>>
```

**返回值**：

- 当`self`为`Ok`时
  - `Ok(Some(_))`转换为`Some(Ok(_))`
  - `Ok(None)`转换为`None`
- 当`self`为`Err`时
  - `Err(_)`转换为`Some(Err(_))`

```rust
// self为Ok，值为Some
let o: Result<Option<i32>, &str> = Ok(Some(123));
let res = o.transpose();
println!("{:?}", res); // Some(Ok(123))

// self为Ok，值为None
let o: Result<Option<i32>, &str> = Ok(None);
let res = o.transpose();
println!("{:?}", res); // None

// self为Err
let o: Result<Option<i32>, &str> = Err("error");
let res = o.transpose();
println!("{:?}", res); // Some(Err("error"))
```

**源码**：

```rust
#[inline]
#[stable(feature = "transpose_result", since = "1.33.0")]
#[rustc_const_unstable(feature = "const_result", issue = "82814")]
pub const fn transpose(self) -> Option<Result<T, E>> {
    match self {
        Ok(Some(x)) => Some(Ok(x)),
        Ok(None) => None,
        Err(e) => Some(Err(e)),
    }
}
```



### impl<T, E> Result<Result<T, E>, E>

#### flatten

从 `Result<Result<T, E>, E>` 转换为 `Result<T, E>`

```rust
pub fn flatten(self) -> Result<T, E>
```

**返回值**：返回被解包的Result

```rust		
let o: Result<Result<i32, &str>, &str> = Ok(Ok(123));
let res = o.flatten();
println!("{:?}", res); // Ok(123)


let o: Result<Result<i32, &str>, &str> = Ok(Err("error"));
let res = o.flatten();
println!("{:?}", res); // Err("error")
```

**源码**：

```rust
#[inline]
#[unstable(feature = "result_flattening", issue = "70142")]
pub fn flatten(self) -> Result<T, E> {
    self.and_then(convert::identity)
}
```







## 4.特征实现

